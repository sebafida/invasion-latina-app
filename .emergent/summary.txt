<analysis>**original_problem_statement:**
L'utilisateur finalise son application avant de la soumettre à l'App Store, mais est confronté à plusieurs problèmes persistants, principalement un bug de stabilité majeur. Après une période d'inactivité, l'application affiche un ancien flyer d'événement et empêche la connexion, obligeant l'utilisateur à désinstaller et réinstaller l'application. Ce problème est la priorité absolue à résoudre.

De plus, l'utilisateur a demandé plusieurs améliorations de l'interface utilisateur et de l'expérience utilisateur :
1.  Corriger l'affichage du nom pour les utilisateurs se connectant via Apple Sign-In, qui affiche actuellement des noms génériques comme Amigo ou user123....
2.  Uniformiser l'espacement entre les boutons dans l'écran de profil.
3.  S'assurer que toutes les notifications sont activées par défaut pour les nouveaux utilisateurs.

**PRODUCT REQUIREMENTS (Current Focus):**
1.  **[P0]** Résoudre définitivement le problème de stabilité de la connexion et d'affichage de l'ancien flyer après une période d'inactivité.
2.  **[P1]** Implémenter une solution pour la gestion du nom des utilisateurs Apple Sign-In.
3.  **[P1]** Corriger les espacements dans l'interface du profil utilisateur.
4.  **[P1]** Assurer que les notifications sont activées par défaut à l'inscription.
5.  **[P2]** Compléter l'interface d'administration pour la gestion des médias (suppression de photos individuelles).

**User's preferred language**: French. The next agent MUST respond in French.

**what currently exists?**
L'application dispose d'un frontend React Native/Expo et d'un backend FastAPI utilisant une base de données Supabase (PostgreSQL), déployé sur Railway. Le backend est stable. Le principal problème réside dans la gestion de l'état du frontend, de la mise en cache et du token d'authentification sur iOS, ce qui cause des problèmes de connexion et d'affichage de données obsolètes lorsque l'application sort de veille. De multiples correctifs ont été appliqués, notamment l'ajout de listeners  pour rafraîchir les données et l'amélioration de la gestion des erreurs API.

**Last working item**:
- Last item agent was working: L'agent a implémenté un ensemble de correctifs pour résoudre les derniers problèmes signalés par l'utilisateur : le nom pour Apple Sign-In, l'espacement dans le profil, et l'activation des notifications par défaut. La solution pour le nom Apple (Option B) consiste à n'afficher que Bienvenue sur l'écran d'accueil et à ajouter un bouton Ajouter votre prénom dans le profil, avec un endpoint backend pour sauvegarder la modification.
- Status: **IN PROGRESS**
- Agent Testing Done: N
- Which testing method agent to use? L'utilisateur doit effectuer des tests manuels via une nouvelle version TestFlight (build 43+). L'agent doit le guider.
- User Testing Done: Y (L'utilisateur a testé la build 43 et a signalé que les problèmes de nom et d'espacement persistaient, indiquant que les derniers correctifs n'avaient pas été inclus dans cette build).

**All Pending/In progress Issue list**:
- Issue 1: Problème de stabilité de la connexion et d'affichage de l'ancien flyer (P0)
- Issue 2: L'affichage du nom pour Apple Sign-In est incorrect (P1)
- Issue 3: Espacement incohérent des boutons dans le profil utilisateur (P1)
- Issue 4: Notifications non activées par défaut à la création du compte (P1)

**Issues Detail**:
- **Issue 1: Problème de stabilité de la connexion et d'affichage de l'ancien flyer**
    - **Attempted fixes**: De nombreuses solutions ont été tentées : migration vers Supabase,  pour forcer la déconnexion, remplacement de l'asset du flyer, ajout de listeners  pour rafraîchir les données, amélioration de la gestion des erreurs API (distinction entre erreurs 401 et erreurs réseau), ajout de logique de retry, et mise en cache des données utilisateur. La dernière tentative visait à rendre la gestion des erreurs réseau plus robuste.
    - **Next debug checklist**:
        1.  S'assurer que le dernier  (qui ne déconnecte que sur erreur 401) et les autres correctifs ont bien été poussés sur GitHub avant que l'utilisateur ne lance un nouveau build.
        2.  Guider l'utilisateur pour créer une nouvelle build (ex: 42 ou supérieure) en s'assurant qu'il a bien fait .
        3.  L'utilisateur doit tester en laissant l'app en arrière-plan pendant plusieurs heures avant de la rouvrir.
        4.  Si le problème persiste, le focus doit rester sur la gestion d'état du frontend au retour de l'application (, , ).
    - **Why fix this issue and what will be achieved with the fix?**: C'est le bug le plus critique qui empêche la soumission de l'application à l'App Store. Sa résolution rendra l'application fiable.
    - **Status**: IN PROGRESS
    - **Is recurring issue?**: Y
    - **Should Test frontend/backend/both after fix?**: Frontend (via TestFlight).
    - **Blocked on other issue**: None.

- **Issue 2, 3 & 4: Problèmes UI/UX (Nom Apple, espacement, notifications)**
    - **Attempted fixes**: L'agent a écrit le code pour : 1) Ajouter un bouton Modifier mon nom pour les utilisateurs Apple. 2) Uniformiser les marges des boutons du profil. 3) Activer les notifications à la création de l'utilisateur dans le backend.
    - **Next debug checklist**:
        1.  L'utilisateur a signalé que ces problèmes n'étaient pas corrigés dans le build 43. Il est quasi certain que les modifications n'ont pas été incluses.
        2.  S'assurer que le code est sauvegardé sur GitHub, puis guider l'utilisateur pour créer un nouveau build (ex: 42 ou supérieur).
        3.  Vérifier les fichiers ,  et .
    - **Why fix this issue and what will be achieved with the fix?**: Améliore la finition et l'expérience utilisateur avant le lancement.
    - **Status**: IN PROGRESS
    - **Is recurring issue?**: Y
    - **Should Test frontend/backend/both after fix?**: Both.
    - **Blocked on other issue**: None.

**In progress Task List**:
- **Task 1: Finaliser et tester les correctifs de stabilité et d'UI (P0)**
    - **Where to resume**: L'agent a terminé une série de correctifs majeurs pour la stabilité et l'UI. La prochaine étape est de guider l'utilisateur pour sauvegarder ces changements sur GitHub, puis de créer une nouvelle build TestFlight (ex: build 42) et de la tester de manière approfondie.
    - **What will be achieved with this?**: Une application stable, fonctionnelle et visuellement correcte, prête à être soumise à l'App Store.
    - **Status**: IN PROGRESS
    - **Should Test frontend/backend/both after fix?**: Both (via les tests de l'utilisateur).
    - **Blocked on something**: Action de l'utilisateur (sauvegarder sur GitHub, créer la build, tester).

**Upcoming and Future Tasks**
- **Upcoming Tasks**:
    - **P1: Implémenter l'UI pour la gestion des médias par l'admin:**
        - Ajouter des boutons de suppression pour les photos individuelles dans .
- **Future Tasks**:
    - **P2:** Implémenter les notifications push pour les rappels d'événements et le statut des demandes de chansons.
    - **P2:** Implémenter les notifications push pour la confirmation des réservations VIP.
    - **P2:** Corriger l'avertissement de version de  dans .
    - Générer et soumettre une build Bêta Android pour le Google Play Store.

**Completed work in this session**
- **Débogage intensif de la stabilité de l'application**: Plusieurs cycles de correctifs sur la gestion du token, l'état de l'application au retour du background (), les erreurs réseau et les timeouts.
- **Remplacement de l'asset du flyer par défaut**: Le fichier  a été remplacé par le nouveau visuel pour éviter d'afficher l'ancien.
- **Améliorations UI/UX**:
    - **Nom Apple Sign-In**: Implémentation d'un flux pour ajouter un nom via un bouton Modifier mon nom et un nouvel endpoint backend ().
    - **Espacement Profil**: Réajustement des marges CSS pour les boutons.
    - **Texte d'accueil**: Modification de la baseline pour afficher l'adresse du Mirano.
- **Correctifs Backend**:
    - Activation des notifications par défaut lors de la création d'un utilisateur.
    - Correction d'un crash  et amélioration de la gestion des erreurs d'authentification.
    - Suppression de la dépendance  pour corriger les builds Railway.

**Code Architecture**


**All files of reference**
- 
- 
- 
- 
- 
- 

**Critical Info for New Agent**
- **LA PRIORITÉ ABSOLUE est de résoudre le bug de stabilité.** L'utilisateur est bloqué et ne peut pas soumettre son application. Le problème est lié à la gestion de l'état du frontend sur iOS au retour de l'application, et non à un cold start du backend. Les derniers correctifs dans  (ne déconnecter que sur 401) sont cruciaux.
- **Workflow avec l'utilisateur :** L'agent fait des modifications -> L'agent demande à l'utilisateur de cliquer sur Save to Github -> L'utilisateur lance les commandes An Expo user account is required to proceed.

Log in to EAS with email or username (exit and run eas login --help to see other login options)
Input is required, but stdin is not readable. Failed to display prompt: Email or username sur son Mac -> L'utilisateur teste sur TestFlight. Il faut s'assurer que le Save to Github est bien fait avant chaque build.
- **Toute la communication doit se faire en français.**

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Signale que même avec la version 43, les problèmes de connexion et d'interface (nom Apple, espacements) persistent.
2.  **User:** Demande une solution pour le nom Apple, suggère de ne rien afficher. L'agent propose d'ajouter un bouton Modifier mon nom.
3.  **User:** Signale à nouveau les problèmes de nom, d'espacement et de notifications non activées par défaut.
4.  **User:** Demande à l'agent de s'assurer que le problème de connexion ne se reproduira plus, même après des heures.
5.  **User:** Signale que l'application est instable, qu'elle fonctionne puis s'arrête de fonctionner.
6.  **User:** Demande si le changement de flyer dans l'admin ne recréera pas le bug.
7.  **User:** Demande de créer la build 40 (car la 39 est déjà utilisée).
8.  **User:** Demande si le problème est censé être résolu ou s'il est résolu.
9.  **User:** Explique en détail via vidéo le problème : l'ancien flyer s'affiche et la connexion échoue.
10. **User:** Demande une vérification complète avant de soumettre la version finale à Apple.

**Project Health Check:**
- **Broken**: L'application est instable en raison d'un bug critique et récurrent de gestion de l'état du frontend, ce qui empêche son déploiement final.

**3rd Party Integrations**
- **Railway** (Hébergement Backend)
- **Supabase** (Base de données principale - PostgreSQL)
- **Cloudinary** (Gestion d'images)
- **Expo Application Services (EAS)**
- **Apple & Google Sign-In**

**Testing status**
- Testing agent used after significant changes: NO
- Troubleshoot agent used after agent stuck in loop: NO
- Test files created: None
- Known regressions: Le bug de stabilité est une régression connue et récurrente.

**Credentials to test flow:**
- **Admin Email**: 
- **Admin Password**: 
- **Supabase Connection String**: Disponible dans  (variable ).</analysis>
